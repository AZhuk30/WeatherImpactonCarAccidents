import requests
import pandas as pd
from datetime import datetime, timedelta

API = "https://data.cityofnewyork.us/resource/h9gi-nx95.csv"

# Get last 7 days
end = datetime.now().strftime('%Y-%m-%d')
start = (datetime.now() - timedelta(7)).strftime('%Y-%m-%d')

# Fetch data
params = {'$limit': 1000, '$where': f"crash_date between '{start}' and '{end}'"}
response = requests.get(API, params=params)

# Save
filename = f"data/collisions_{start}_to_{end}.csv"
open(filename, 'wb').write(response.content)

# Display
df = pd.read_csv(filename)
print(f" {len(df)} records saved to {filename}")
print(df['borough'].value_counts())
